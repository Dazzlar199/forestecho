{
  "metadata": {
    "generated": "2026-01-30",
    "project": "ForestEcho (숲울림)",
    "description": "AI Mental Health Counseling Platform",
    "techStack": ["Next.js 16", "React 19", "TypeScript 5.9", "Firebase", "Gemini AI", "OpenAI"]
  },
  "metrics": {
    "totalSourceFiles": 130,
    "totalLinesOfCode": 42000,
    "largestFile": {
      "path": "types/education.ts",
      "lines": 17180,
      "sizeKB": 856,
      "severity": "critical"
    },
    "apiRoutes": {
      "active": 5,
      "empty": 1
    },
    "firebaseIntegrationPoints": 20,
    "aiProviders": 2,
    "emptyDirectories": 3
  },
  "structure": {
    "app": {
      "path": "/app/",
      "sizeKB": 356,
      "fileCount": 30,
      "routes": [
        "/",
        "/admin",
        "/analysis/[id]",
        "/assessment",
        "/checkin",
        "/community",
        "/disclaimer",
        "/education",
        "/education/[slug]",
        "/emotion",
        "/faq",
        "/myforest",
        "/offline",
        "/support",
        "/terms"
      ]
    },
    "components": {
      "path": "/components/",
      "sizeKB": 520,
      "fileCount": 87,
      "categories": [
        "analysis (7)",
        "apps-in-toss (1)",
        "assessment (2)",
        "audio (1)",
        "auth (2)",
        "chat (3)",
        "checkin (3)",
        "community (3)",
        "counseling (2)",
        "crisis (1)",
        "education (4)",
        "emotion (6)",
        "forest (3)",
        "layout (7)",
        "onboarding (3)",
        "premium (1)",
        "profile (1)",
        "pwa (1)",
        "referral (2)",
        "trust (4)"
      ]
    },
    "lib": {
      "path": "/lib/",
      "sizeKB": 228,
      "fileCount": 31,
      "modules": [
        "firebase (11)",
        "gemini (9)",
        "openai (9)",
        "rag (4)",
        "referral (3)",
        "search (1)",
        "utils (2)",
        "apps-in-toss (1)"
      ]
    },
    "types": {
      "path": "/types/",
      "sizeKB": 928,
      "fileCount": 9,
      "files": [
        "analysis.ts",
        "assessment.ts (583 lines)",
        "chat.ts",
        "checkin.ts (302 lines)",
        "community.ts (307 lines)",
        "education.ts (17180 lines - CRITICAL)",
        "emotion.ts",
        "index.ts",
        "user.ts"
      ]
    }
  },
  "apiRoutes": {
    "active": [
      {
        "path": "/api/analysis",
        "method": "POST",
        "description": "Generate AI analysis report",
        "dependencies": ["Firebase Admin", "OpenAI", "Gemini"]
      },
      {
        "path": "/api/chat",
        "method": "POST",
        "description": "Streaming AI chat",
        "lines": 457,
        "dependencies": [
          "Gemini 3 Flash (premium/basic)",
          "GPT-4o-mini (free/guest)",
          "Firebase Admin",
          "RAG Search",
          "Tavily",
          "Rate limiting"
        ]
      },
      {
        "path": "/api/referral",
        "method": "POST/GET",
        "description": "Referral tracking",
        "dependencies": ["Firebase Admin"]
      },
      {
        "path": "/api/seed-faq",
        "method": "POST",
        "description": "Seed FAQ data",
        "dependencies": ["Firebase Admin"]
      },
      {
        "path": "/api/rss.xml",
        "method": "GET",
        "description": "RSS feed generation",
        "dependencies": []
      }
    ],
    "empty": [
      {
        "path": "/app/api/auth",
        "status": "empty directory",
        "action": "delete or implement"
      }
    ]
  },
  "firebaseIntegration": {
    "services": [
      "Authentication (Email, Google, Anonymous)",
      "Firestore Database",
      "Security Rules"
    ],
    "collections": [
      "users",
      "chatSessions",
      "emotionTracking",
      "analyses",
      "subscriptions",
      "referrals",
      "faqs",
      "communityPosts"
    ],
    "clientFiles": [
      "components/auth/AuthModal.tsx",
      "components/layout/AuthProvider.tsx",
      "components/layout/Header.tsx",
      "components/layout/MobileHeader.tsx",
      "components/profile/NicknameModal.tsx",
      "lib/firebase/config.ts"
    ],
    "adminFiles": [
      "app/api/analysis/route.ts",
      "app/api/chat/route.ts",
      "app/api/seed-faq/route.ts",
      "lib/firebase/admin.ts",
      "lib/firebase/emotion-tracking-admin.ts",
      "lib/firebase/user-subscription-admin.ts",
      "lib/referral/referral-admin.ts"
    ]
  },
  "deadCode": [
    {
      "path": "/public/music/",
      "sizeMB": 17,
      "severity": "critical",
      "reason": "BGMPlayer component commented out",
      "files": [
        "forest-whispers.mp3 (3.7MB)",
        "golden-hour-dreams.mp3 (2.1MB)",
        "healing-rain-therapy.mp3 (2.7MB)",
        "ocean-reverie.mp3 (2.2MB)",
        "starlit-reverie.mp3 (3.1MB)",
        "weightless-dreams.mp3 (2.9MB)"
      ],
      "action": "Delete entire directory"
    },
    {
      "path": "components/audio/BGMPlayer.tsx",
      "severity": "medium",
      "reason": "Imported but commented out in app/page.tsx",
      "action": "Delete file and remove import"
    },
    {
      "path": "functions/",
      "sizeMB": 144,
      "severity": "high",
      "reason": "Appears to be legacy code, app uses Next.js API routes",
      "action": "Verify unused and delete"
    },
    {
      "path": "lib/gemini/advanced-prompts.ts",
      "lines": 6,
      "severity": "low",
      "reason": "Only re-exports enhanced-prompts.ts",
      "action": "Delete and use enhanced-prompts directly"
    },
    {
      "path": "app/api/auth/",
      "severity": "low",
      "reason": "Empty directory",
      "action": "Delete or implement"
    },
    {
      "path": "public/images/",
      "severity": "low",
      "reason": "Empty directory",
      "action": "Delete or add placeholder"
    }
  ],
  "duplicateCode": [
    {
      "files": [
        "lib/openai/counseling-modes.ts",
        "lib/gemini/counseling-modes.ts"
      ],
      "lines": 370,
      "similarity": "100%",
      "severity": "high",
      "action": "Extract to lib/ai/shared/counseling-modes.ts"
    },
    {
      "files": [
        "lib/openai/context-manager.ts",
        "lib/gemini/context-manager.ts"
      ],
      "lines": 191,
      "similarity": "100%",
      "severity": "high",
      "action": "Extract to lib/ai/shared/context-manager.ts"
    },
    {
      "files": [
        "app/api/chat/route.ts (lines 36-77)",
        "functions/index.js (lines 48-83)"
      ],
      "description": "Tone guidance logic duplicated",
      "severity": "medium",
      "action": "Centralize in shared utility"
    }
  ],
  "performanceBottlenecks": [
    {
      "issue": "Massive education types file",
      "file": "types/education.ts",
      "sizeKB": 856,
      "lines": 17180,
      "severity": "critical",
      "impact": "Bloats bundle by ~1MB, slows TS compilation",
      "solution": "Move article data to JSON files or database",
      "estimatedSavings": "850KB bundle, 50% faster compilation"
    },
    {
      "issue": "Unused audio files",
      "path": "/public/music/",
      "sizeMB": 17,
      "severity": "critical",
      "impact": "Wastes 17MB in production build",
      "solution": "Delete entire directory",
      "estimatedSavings": "17MB"
    },
    {
      "issue": "In-memory rate limiting",
      "file": "lib/rate-limit.ts",
      "severity": "high",
      "impact": "Doesn't work across serverless instances",
      "solution": "Use Upstash Redis or Vercel KV",
      "estimatedSavings": "Better security, consistent rate limits"
    },
    {
      "issue": "Large component files",
      "files": [
        "app/admin/page.tsx (720 lines)",
        "components/layout/Header.tsx (783 lines)"
      ],
      "severity": "medium",
      "impact": "Harder to maintain, slower HMR",
      "solution": "Split into smaller components",
      "estimatedSavings": "Better DX, faster rebuilds"
    }
  ],
  "securityAudit": {
    "contentSafety": {
      "layers": 3,
      "files": [
        "lib/gemini/response-filter.ts (pre-request)",
        "lib/gemini/context-manager.ts (crisis detection)",
        "app/api/chat/route.ts (post-response)"
      ],
      "status": "good"
    },
    "rateLimiting": {
      "implementation": "in-memory",
      "limit": "10 requests/min",
      "issue": "Doesn't work in serverless",
      "recommendation": "Migrate to Upstash Redis"
    },
    "authentication": {
      "provider": "Firebase Auth",
      "methods": ["Email/Password", "Google OAuth", "Anonymous"],
      "status": "good"
    },
    "dataIsolation": {
      "method": "Firestore security rules",
      "userIdBased": true,
      "status": "good"
    }
  },
  "dependencies": {
    "core": [
      "@google/generative-ai@0.24.1",
      "@pinecone-database/pinecone@6.1.4",
      "@tavily/core@0.5.12",
      "firebase@12.4.0",
      "firebase-admin@13.5.0",
      "openai@6.17.0",
      "next@16.0.0",
      "react@19.2.0"
    ],
    "ui": [
      "framer-motion@12.23.24",
      "lucide-react@0.548.0",
      "recharts@3.7.0",
      "tailwindcss@3.4.18"
    ],
    "utilities": [
      "html2canvas@1.4.1",
      "react-confetti@6.4.0",
      "zod@4.1.12"
    ],
    "potentiallyUnused": [
      "@apps-in-toss/web-framework (TODO implementation)"
    ]
  },
  "todos": [
    {
      "file": "components/apps-in-toss/AppsInTossProvider.tsx",
      "todo": "Implement Toss SDK",
      "priority": "high"
    },
    {
      "file": "components/emotion/EmotionCheckin.tsx",
      "todo": "Add emotion intensity levels",
      "priority": "medium"
    },
    {
      "file": "components/trust/UpgradeModal.tsx",
      "todo": "Integrate with payment system",
      "priority": "high"
    },
    {
      "file": "lib/referral/referral-utils.ts",
      "todo": "Add referral reward calculation",
      "priority": "medium"
    }
  ],
  "actionPlan": {
    "phase1": {
      "name": "Critical Performance Fixes",
      "duration": "1 week",
      "tasks": [
        {
          "task": "Refactor education types",
          "action": "Move article data to JSON/database",
          "impact": "-850KB bundle"
        },
        {
          "task": "Remove dead music files",
          "action": "Delete /public/music/ and BGMPlayer",
          "impact": "-17MB"
        }
      ],
      "estimatedImpact": "-18MB build size, +50% faster builds"
    },
    "phase2": {
      "name": "Code Deduplication",
      "duration": "1 week",
      "tasks": [
        {
          "task": "Consolidate AI logic",
          "action": "Create lib/ai/shared/ for common code",
          "impact": "-15KB code"
        },
        {
          "task": "Remove duplicate functions directory",
          "action": "Delete functions/ if confirmed unused",
          "impact": "-144MB disk"
        }
      ],
      "estimatedImpact": "-15KB code, -144MB disk space"
    },
    "phase3": {
      "name": "Infrastructure",
      "duration": "1 week",
      "tasks": [
        {
          "task": "Distributed rate limiting",
          "action": "Implement Upstash Redis rate limiting",
          "impact": "Better security"
        },
        {
          "task": "Add basic tests",
          "action": "Test crisis detection, filtering, API errors",
          "impact": "Prevent regressions"
        }
      ]
    },
    "phase4": {
      "name": "Code Organization",
      "duration": "1 week",
      "tasks": [
        {
          "task": "Split large components",
          "action": "Break down admin page, header into smaller files",
          "impact": "Better maintainability"
        },
        {
          "task": "Clean up empty directories",
          "action": "Remove api/auth, public/images, .serena/memories",
          "impact": "Cleaner repo"
        }
      ]
    }
  },
  "environmentVariables": {
    "required": [
      "GEMINI_API_KEY",
      "OPENAI_API_KEY",
      "NEXT_PUBLIC_FIREBASE_API_KEY",
      "NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN",
      "NEXT_PUBLIC_FIREBASE_PROJECT_ID",
      "NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET",
      "NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID",
      "NEXT_PUBLIC_FIREBASE_APP_ID"
    ],
    "optional": [
      "TAVILY_API_KEY",
      "PINECONE_API_KEY",
      "PINECONE_ENVIRONMENT",
      "PINECONE_INDEX_NAME",
      "NEXT_PUBLIC_ADSENSE_CLIENT_ID",
      "NEXT_PUBLIC_BASE_URL"
    ]
  },
  "quickWins": [
    "Delete /public/music/ directory (-17MB)",
    "Delete components/audio/BGMPlayer.tsx",
    "Move education data to JSON (-850KB bundle)",
    "Delete /app/api/auth/ empty directory",
    "Add .gitignore rule for .serena/memories/"
  ],
  "strengths": [
    "Modern tech stack (Next.js 16, React 19, TypeScript 5.9)",
    "Multi-AI support with tier-based routing",
    "Comprehensive 3-layer content filtering",
    "Good UX (streaming, auto language detection, gamification)",
    "PWA support with offline functionality"
  ],
  "weaknesses": [
    "17,180-line education.ts file (critical)",
    "17MB unused music files",
    "90% code duplication between OpenAI/Gemini",
    "In-memory rate limiting (serverless issue)",
    "Zero test coverage"
  ]
}
